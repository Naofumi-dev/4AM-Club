<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="4AM Club">
    <title>4AM Club - Solo Dad System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        :root {
            --primary: #ff6b35;
            --primary-dark: #e85d2e;
            --secondary: #f7931e;
            --success: #10b981;
            --warning: #fbbf24;
            --danger: #dc2626;
            --dark: #0a0a0a;
            --dark-2: #1a1a1a;
            --dark-3: #2a2a2a;
            --text: #ffffff;
            --text-dim: #888888;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark);
            color: var(--text);
            overflow-x: hidden;
            padding-bottom: 80px;
        }
        
        .header {
            position: sticky;
            top: 0;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(20px);
            padding: 16px 20px;
            z-index: 100;
            border-bottom: 1px solid var(--dark-3);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 900;
            color: white;
        }
        
        .logo-text h1 {
            font-size: 22px;
            font-weight: 900;
            color: var(--text);
        }
        
        .logo-text p {
            font-size: 10px;
            color: var(--text-dim);
            letter-spacing: 1.5px;
            font-weight: 600;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 0;
            scrollbar-width: none;
        }
        
        .tabs::-webkit-scrollbar { display: none; }
        
        .tab {
            padding: 10px 18px;
            background: var(--dark-2);
            border: 1px solid var(--dark-3);
            border-radius: 10px;
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            color: var(--text-dim);
        }
        
        .tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        .quote-card {
            background: linear-gradient(135deg, var(--primary), #e85d2e);
            border-radius: 16px;
            padding: 24px;
            margin: 16px 20px;
        }
        
        .quote-text {
            font-size: 17px;
            line-height: 1.5;
            font-weight: 600;
            margin-bottom: 16px;
            color: white;
        }
        
        .refresh-quote {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 0 20px 20px;
        }
        
        .stat-card {
            background: var(--dark-2);
            border: 1px solid var(--dark-3);
            border-radius: 14px;
            padding: 18px;
            position: relative;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 900;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-dim);
        }
        
        .content {
            padding: 20px;
        }
        
        .view {
            display: none;
        }
        
        .view.active {
            display: block;
        }
        
        .task-card {
            background: var(--dark-2);
            border: 1px solid var(--dark-3);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
        }
        
        .task-card.completed {
            opacity: 0.5;
        }
        
        .task-header {
            display: flex;
            gap: 12px;
        }
        
        .checkbox {
            min-width: 24px;
            height: 24px;
            border: 2px solid var(--dark-3);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .task-card.completed .checkbox {
            background: var(--success);
            border-color: var(--success);
        }
        
        .checkbox::after {
            content: '✓';
            color: white;
            font-weight: bold;
            opacity: 0;
        }
        
        .task-card.completed .checkbox::after {
            opacity: 1;
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        .task-meta {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: var(--text-dim);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            font-size: 13px;
            color: var(--text-dim);
            margin-bottom: 8px;
            display: block;
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            background: var(--dark);
            border: 1px solid var(--dark-3);
            border-radius: 10px;
            padding: 12px 16px;
            color: var(--text);
            font-size: 15px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .notion-card {
            background: var(--dark-2);
            border: 1px solid var(--dark-3);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .notion-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: var(--dark);
            border-radius: 10px;
            margin-bottom: 16px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--danger);
        }
        
        .status-dot.connected {
            background: var(--success);
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .alert-danger {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--dark-3);
            padding: 8px 20px;
            display: flex;
            justify-content: space-around;
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 10px;
        }
        
        .nav-item.active {
            background: var(--dark-2);
        }
        
        .nav-item i {
            font-size: 20px;
            color: var(--text-dim);
        }
        
        .nav-item.active i {
            color: var(--primary);
        }
        
        .nav-label {
            font-size: 11px;
            color: var(--text-dim);
            font-weight: 600;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-icon {
            font-size: 48px;
            opacity: 0.2;
            margin-bottom: 16px;
        }
        
        .client-item {
            background: var(--dark-2);
            border: 1px solid var(--dark-3);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .client-avatar {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 900;
            color: white;
        }
        
        .client-info {
            flex: 1;
        }
        
        .client-name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .chart-wrapper {
            height: 280px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="logo">
                <div class="logo-icon">4A</div>
                <div class="logo-text">
                    <h1>4AM CLUB</h1>
                    <p>SOLO DAD SYSTEM</p>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-view="dashboard">Dashboard</div>
            <div class="tab" data-view="habits">Habits</div>
            <div class="tab" data-view="clients">Clients</div>
            <div class="tab" data-view="weight">Weight</div>
            <div class="tab" data-view="notion">Notion</div>
        </div>
    </div>
    
    <div class="quote-card">
        <div class="quote-text" id="quoteText">Loading...</div>
        <button class="refresh-quote" id="refreshQuote">New Truth</button>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value" id="streakDays">0</div>
            <div class="stat-label">Day Streak</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="habitsToday">0/8</div>
            <div class="stat-label">Today's Habits</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="clientCount">0</div>
            <div class="stat-label">Active Leads</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="weightDiff">--</div>
            <div class="stat-label">Weight Change</div>
        </div>
    </div>
    
    <div class="content">
        <div class="view active" id="dashboard">
            <div class="section-title">Today's Mission</div>
            <div id="todayTasks">
                <div class="empty-state">
                    <div class="empty-icon"><i class="fas fa-tasks"></i></div>
                    <div style="color: var(--text-dim);">Add tasks to start tracking</div>
                </div>
            </div>
        </div>
        
        <div class="view" id="habits">
            <div class="section-title">Daily Habits</div>
            <div id="habitsList"></div>
        </div>
        
        <div class="view" id="clients">
            <div class="section-title">Client Pipeline</div>
            <div id="clientsList">
                <div class="empty-state">
                    <div class="empty-icon"><i class="fas fa-users"></i></div>
                    <div style="color: var(--text-dim);">No clients yet</div>
                </div>
            </div>
        </div>
        
        <div class="view" id="weight">
            <div class="section-title">Weight Tracker</div>
            <div class="notion-card">
                <div class="form-group">
                    <label class="form-label">Weight (kg)</label>
                    <input type="number" class="form-input" id="weightInput" placeholder="75.5" step="0.1">
                </div>
                <button class="btn btn-primary" id="addWeightBtn" style="width: 100%;">Add Entry</button>
            </div>
            <div class="notion-card">
                <div class="chart-wrapper">
                    <canvas id="weightChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="view" id="notion">
            <div id="notionAlert"></div>
            
            <div class="notion-card">
                <div class="section-title">Notion Integration</div>
                
                <div class="notion-status">
                    <div class="status-dot" id="notionStatusDot"></div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 4px;" id="notionStatusText">Not Connected</div>
                        <div style="font-size: 12px; color: var(--text-dim);">Sync job apps & outreach</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Integration Token</label>
                    <input type="password" class="form-input" id="notionApiKey" placeholder="secret_...">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Database ID</label>
                    <input type="text" class="form-input" id="notionDatabaseId" placeholder="Database ID">
                </div>
                
                <button class="btn btn-primary" id="connectNotionBtn" style="width: 100%; margin-bottom: 8px;">
                    <i class="fab fa-notion"></i> <span id="notionBtnText">Connect</span>
                </button>
                
                <button class="btn" id="testNotionBtn" style="width: 100%; background: var(--dark); color: var(--text); display: none;">
                    Test Connection
                </button>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 16px;">
                    <div style="background: var(--dark); padding: 16px; border-radius: 10px;">
                        <div style="font-size: 28px; font-weight: 900; color: var(--primary);" id="jobAppsCount">0</div>
                        <div style="font-size: 12px; color: var(--text-dim);">Job Applications</div>
                    </div>
                    <div style="background: var(--dark); padding: 16px; border-radius: 10px;">
                        <div style="font-size: 28px; font-weight: 900; color: var(--primary);" id="outreachCount">0</div>
                        <div style="font-size: 12px; color: var(--text-dim);">Client Outreach</div>
                    </div>
                </div>
            </div>
            
            <div class="notion-card">
                <div class="section-title" style="margin-bottom: 12px;">Setup Guide</div>
                <ol style="padding-left: 20px; color: var(--text-dim); font-size: 14px; line-height: 1.8;">
                    <li style="margin-bottom: 8px;">Visit <a href="https://www.notion.so/my-integrations" target="_blank" style="color: var(--primary);">notion.so/my-integrations</a></li>
                    <li style="margin-bottom: 8px;">Create integration, copy token</li>
                    <li style="margin-bottom: 8px;">Open database → "..." → Add connections</li>
                    <li style="margin-bottom: 8px;">Copy database ID from URL</li>
                    <li>Paste above and connect</li>
                </ol>
            </div>
        </div>
    </div>
    
    <div class="bottom-nav">
        <div class="nav-item active" data-nav="dashboard">
            <i class="fas fa-home"></i>
            <div class="nav-label">Home</div>
        </div>
        <div class="nav-item" data-nav="habits">
            <i class="fas fa-fire"></i>
            <div class="nav-label">Habits</div>
        </div>
        <div class="nav-item" data-nav="clients">
            <i class="fas fa-briefcase"></i>
            <div class="nav-label">Clients</div>
        </div>
        <div class="nav-item" data-nav="weight">
            <i class="fas fa-chart-line"></i>
            <div class="nav-label">Progress</div>
        </div>
    </div>
    
    <script>
        const truths = [
            "Your kids are watching everything you do. Don't waste their example on excuses.",
            "Every morning you sleep in is money you're not making and time you can't get back.",
            "Nobody's coming to save you. You're the only hero your kids need.",
            "The gym doesn't care about your feelings. Neither does your bank account.",
            "Stop talking about it. Your kids need results, not promises.",
            "Wake up at 4AM or wake up broke. Your call.",
            "Every rep, every client call, every journal entry - it all counts."
        ];
        
        let appState = {
            habits: [
                { id: 1, name: 'Meditation', time: '4:00 AM', completed: false },
                { id: 2, name: 'Morning Journal', time: '4:15 AM', completed: false },
                { id: 3, name: 'Automation Learning', time: '4:45 AM', completed: false },
                { id: 4, name: 'Gym Session', time: '6:00 AM', completed: false },
                { id: 5, name: 'Client Work', time: '10:00 AM', completed: false },
                { id: 6, name: 'Evening Journal', time: '10:00 PM', completed: false },
                { id: 7, name: 'Reading', time: '10:30 PM', completed: false },
                { id: 8, name: 'Sleep by 11pm', time: '11:00 PM', completed: false }
            ],
            clients: [],
            weightHistory: [],
            notionConnected: false,
            notionApiKey: '',
            notionDatabaseId: '',
            notionData: { jobApps: 0, outreach: 0 }
        };
        
        function loadState() {
            const saved = localStorage.getItem('4amClubState');
            if (saved) {
                try {
                    appState = { ...appState, ...JSON.parse(saved) };
                } catch (e) {}
            }
        }
        
        function saveState() {
            localStorage.setItem('4amClubState', JSON.stringify(appState));
        }
        
        function init() {
            loadState();
            renderQuote();
            renderStats();
            renderHabits();
            renderWeightChart();
            updateNotionUI();
            setupEventListeners();
        }
        
        function renderQuote() {
            document.getElementById('quoteText').textContent = truths[Math.floor(Math.random() * truths.length)];
        }
        
        function renderStats() {
            const completed = appState.habits.filter(h => h.completed).length;
            document.getElementById('streakDays').textContent = completed === 8 ? 1 : 0;
            document.getElementById('habitsToday').textContent = `${completed}/8`;
            document.getElementById('clientCount').textContent = appState.clients.length;
            
            if (appState.weightHistory.length >= 2) {
                const latest = appState.weightHistory[appState.weightHistory.length - 1].weight;
                const previous = appState.weightHistory[appState.weightHistory.length - 2].weight;
                const diff = (latest - previous).toFixed(1);
                document.getElementById('weightDiff').textContent = `${diff > 0 ? '+' : ''}${diff} kg`;
            }
        }
        
        function renderHabits() {
            const container = document.getElementById('habitsList');
            container.innerHTML = '';
            
            appState.habits.forEach(habit => {
                const card = document.createElement('div');
                card.className = `task-card ${habit.completed ? 'completed' : ''}`;
                card.innerHTML = `
                    <div class="task-header">
                        <div class="checkbox"></div>
                        <div class="task-info">
                            <div class="task-title">${habit.name}</div>
                            <div class="task-meta">${habit.time}</div>
                        </div>
                    </div>
                `;
                card.onclick = () => {
                    habit.completed = !habit.completed;
                    saveState();
                    renderHabits();
                    renderStats();
                };
                container.appendChild(card);
            });
        }
        
        let weightChart = null;
        function renderWeightChart() {
            const ctx = document.getElementById('weightChart');
            if (weightChart) weightChart.destroy();
            
            if (appState.weightHistory.length === 0) return;
            
            const labels = appState.weightHistory.map(e => new Date(e.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            const data = appState.weightHistory.map(e => e.weight);
            
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Weight (kg)',
                        data,
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: false, grid: { color: '#2a2a2a' }, ticks: { color: '#888888' } },
                        x: { grid: { color: '#2a2a2a' }, ticks: { color: '#888888' } }
                    }
                }
            });
        }
        
        function updateNotionUI() {
            const dot = document.getElementById('notionStatusDot');
            const text = document.getElementById('notionStatusText');
            const btnText = document.getElementById('notionBtnText');
            const testBtn = document.getElementById('testNotionBtn');
            
            if (appState.notionConnected) {
                dot.classList.add('connected');
                text.textContent = 'Connected';
                btnText.textContent = 'Disconnect';
                testBtn.style.display = 'block';
                
                if (appState.notionApiKey) document.getElementById('notionApiKey').value = appState.notionApiKey;
                if (appState.notionDatabaseId) document.getElementById('notionDatabaseId').value = appState.notionDatabaseId;
            } else {
                dot.classList.remove('connected');
                text.textContent = 'Not Connected';
                btnText.textContent = 'Connect';
                testBtn.style.display = 'none';
            }
            
            document.getElementById('jobAppsCount').textContent = appState.notionData.jobApps;
            document.getElementById('outreachCount').textContent = appState.notionData.outreach;
        }
        
        function showAlert(message, type = 'success') {
            const container = document.getElementById('notionAlert');
            container.innerHTML = `
                <div class="alert alert-${type}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            setTimeout(() => container.innerHTML = '', 5000);
        }
        
        // BACKEND API URL - UPDATE THIS AFTER DEPLOYING BACKEND
        const API_URL = 'https://4am-club-backend.vercel.app/'; // TODO: Replace with your backend URL
        
        async function connectNotion() {
            const apiKey = document.getElementById('notionApiKey').value.trim();
            const databaseId = document.getElementById('notionDatabaseId').value.trim();
            
            if (!apiKey || !databaseId) {
                showAlert('Please enter both API key and Database ID', 'danger');
                return;
            }
            
            // Check if API_URL is still placeholder
            if (API_URL.includes('YOUR-BACKEND-URL')) {
                showAlert('Please deploy the backend first and update API_URL in the code', 'danger');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/notion/database/${databaseId}`, {
                    method: 'GET',
                    headers: {
                        'x-notion-api-key': apiKey
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    appState.notionConnected = true;
                    appState.notionApiKey = apiKey;
                    appState.notionDatabaseId = databaseId;
                    saveState();
                    updateNotionUI();
                    showAlert('Successfully connected!', 'success');
                    await fetchNotionData();
                } else {
                    showAlert(`Failed: ${data.error || 'Invalid credentials'}`, 'danger');
                }
            } catch (error) {
                showAlert(`Connection error: ${error.message}`, 'danger');
                console.error('Notion error:', error);
            }
        }
        
        async function fetchNotionData() {
            if (!appState.notionConnected) return;
            
            try {
                const response = await fetch(`${API_URL}/api/notion/query`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-notion-api-key': appState.notionApiKey
                    },
                    body: JSON.stringify({
                        databaseId: appState.notionDatabaseId
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    appState.notionData.jobApps = data.total_count || data.results.length;
                    appState.notionData.outreach = Math.floor(appState.notionData.jobApps * 0.7);
                    saveState();
                    updateNotionUI();
                    showAlert('Data synced!', 'success');
                } else {
                    showAlert(`Sync failed: ${data.error || 'Unknown error'}`, 'danger');
                }
            } catch (error) {
                showAlert(`Sync error: ${error.message}`, 'danger');
                console.error('Fetch error:', error);
            }
        }
        
        function setupEventListeners() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const view = tab.dataset.view;
                    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    document.getElementById(view).classList.add('active');
                    tab.classList.add('active');
                    document.querySelector(`.nav-item[data-nav="${view}"]`)?.classList.add('active');
                });
            });
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const nav = item.dataset.nav;
                    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    document.getElementById(nav).classList.add('active');
                    document.querySelector(`.tab[data-view="${nav}"]`)?.classList.add('active');
                    item.classList.add('active');
                });
            });
            
            document.getElementById('refreshQuote').addEventListener('click', renderQuote);
            
            document.getElementById('addWeightBtn').addEventListener('click', () => {
                const weight = parseFloat(document.getElementById('weightInput').value);
                if (weight && weight > 0 && weight < 500) {
                    appState.weightHistory.push({ date: new Date().toISOString(), weight });
                    saveState();
                    renderWeightChart();
                    renderStats();
                    document.getElementById('weightInput').value = '';
                }
            });
            
            document.getElementById('connectNotionBtn').addEventListener('click', () => {
                if (appState.notionConnected) {
                    if (confirm('Disconnect from Notion?')) {
                        appState.notionConnected = false;
                        appState.notionApiKey = '';
                        appState.notionDatabaseId = '';
                        document.getElementById('notionApiKey').value = '';
                        document.getElementById('notionDatabaseId').value = '';
                        saveState();
                        updateNotionUI();
                    }
                } else {
                    connectNotion();
                }
            });
            
            document.getElementById('testNotionBtn').addEventListener('click', fetchNotionData);
        }
        
        init();
    </script>
</body>
</html>
